<!DOCTYPE html>
<html lang="en">
<head>
    <style>@font-face {
  font-family: Lexis;
  src: url("fonts/lexis.woff2") format("woff2");
}

.phoneBtn {
  color: #1c1a36;
  background-color: #9dceb1;
  border: 1px solid #1c1a36;
  padding: 2px;
  font-size: 8px;
}

.phoneBtn:hover {
  color: #9dceb1;
  border: border: 1px solid transparent;
  cursor: pointer;
  background-color: #1c1a36;
  padding: 2px;
  font-size: 8px;
  left: 114px;
}

.crt:before {
  content: " ";
  z-index: 3;
  pointer-events: none;
  background: linear-gradient(#12101000 20%, #00000040 20%) 0 0 / 100% 2px, linear-gradient(90deg, #ff00000f, #00ff0005, #0000ff0f) 0 0 / 3px 100%;
  display: block;
  position: fixed;
  inset: 0;
}

.crt:after {
  content: " ";
  opacity: 0;
  z-index: 3;
  pointer-events: none;
  background: #1210101a;
  animation: .15s infinite flicker;
  display: block;
  position: fixed;
  inset: 0;
}

.crt-image {
  filter: contrast(1.1) brightness(.95) saturate(1.2);
  z-index: 1;
  border-radius: 12px;
  height: auto;
  display: block;
  position: relative;
  overflow: hidden;
  transform: scale(1.02);
  -webkit-mask-image: radial-gradient(circle, #000 50%, #0000 100%);
  mask-image: radial-gradient(circle, #000 50%, #0000 100%);
}

.screen-overlay {
  z-index: 2;
  background: linear-gradient(#e1ffff80, #e1ffff00);
}

.loading-box {
  background-image: url("loading_bar.png");
  width: 162px;
  height: 8px;
  position: absolute;
  top: 96px;
  overflow: hidden;
}

.loader {
  background-image: url("loading_bar_fill.png");
  width: 100%;
  height: 100%;
  animation: 3s linear infinite load;
  position: absolute;
  left: -100%;
}

@keyframes load {
  0% {
    left: -100%;
  }

  100% {
    left: 100%;
  }
}

.tile-body {
  color: #fff;
  background-color: #fff;
  font-size: 12px;
}

#puzzle {
  border-spacing: 0;
  margin-top: 8px;
}

#puzzle th, td {
  margin: 0;
  padding: 0;
}

.selected {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  border: 2px solid #ff0;
}

.puzzle-block {
  background-image: url("puzzle260202.png");
  width: 53px;
  height: 50px;
}

.p1A {
  background-position: 0 0;
}

.p1B {
  background-position: -53px 0;
}

.p1C {
  background-position: -106px 0;
}

.p1D {
  background-position: -159px 0;
}

.p2A {
  background-position: 0 -50px;
}

.p2B {
  background-position: -53px -50px;
}

.p2C {
  background-position: -106px -50px;
}

.p2D {
  background-position: -159px -50px;
}

.p3A {
  background-position: 0 -100px;
}

.p3B {
  background-position: -53px -100px;
}

.p3C {
  background-position: -106px -100px;
}

.p3D {
  background-position: -159px -100px;
}

.p4A {
  background-position: 0 -150px;
}

.p4B {
  background-position: -53px -150px;
}

.p4C {
  background-position: -106px -150px;
}

.p4D {
  background-position: -159px -150px;
}

.pixel {
  font-family: Lexis, MS Ghotic, Arial;
}

.main-window {
  background-image: url("bg_collab.gif");
  width: 250px;
  height: 250px;
  display: flex;
}

.main-window2 {
  background-image: url("lcd.png");
  width: 250px;
  height: 250px;
  display: flex;
}

.main-windowp {
  background-image: url("bgwbackbtn.png");
  width: 250px;
  height: 250px;
  display: flex;
}

.deepFried {
  image-rendering: pixelated;
}

.game-button {
  image-rendering: pixelated;
  color: #fff;
  cursor: pointer;
  border-style: solid;
  background-color: #000;
  border-image-source: url("9slice_buttonlink.png");
  border-image-slice: 9;
  border-image-width: 8px;
  border-image-repeat: round;
  margin: 4px;
}

.game-button:hover {
  border-image-source: url("9slice_buttonlinkhover.png");
}

.nineslice {
  image-rendering: pixelated;
  color: #fff;
  cursor: pointer;
  border-style: solid;
  background-color: #000;
  border-image-source: url("9slice_buttonlink.png");
  border-image-slice: 9;
  border-image-width: 8px;
  border-image-repeat: round;
  min-width: 96px;
  min-height: 16px;
  padding: 7px;
  font-size: 12px;
}

.nineslice:hover {
  border-image-source: url("9slice_buttonlinkhover.png");
}

.container {
  flex-direction: column;
  width: 100%;
  height: 100%;
  max-height: 212px;
  margin: 12px 12px 25px 16px;
  padding-left: 4px;
  padding-right: 4px;
  display: flex;
  overflow-y: auto;
}

.container::-webkit-scrollbar-track {
  background-color: #625198;
}

.container::-webkit-scrollbar {
  width: 10px;
}

.container::-webkit-scrollbar-thumb {
  background-color: #a093c5;
}

.lcd-button {
  color: #1c1a36;
  padding: 10px;
}

.lcd-button:hover {
  cursor: pointer;
  color: #9dceb1;
  background-color: #1c1a36;
}

.flex {
  display: flex;
}

.flex-row {
  flex-direction: row;
}

.flex-column {
  flex-direction: column;
}

.flex-wrap {
  flex-wrap: wrap;
}

.items-start {
  align-items: flex-start;
}

.items-end {
  align-items: flex-end;
}

.items-center {
  align-items: center;
}

.justify-normal {
  justify-content: normal;
}

.justify-start {
  justify-content: flex-start;
}

.justify-end {
  justify-content: flex-end;
}

.justify-center {
  justify-content: center;
}

.justify-between {
  justify-content: space-between;
}

.justify-around {
  justify-content: space-around;
}

.justify-evenly {
  justify-content: space-evenly;
}

.justify-stretch {
  justify-content: stretch;
}

.justify-items-start {
  justify-items: start;
}

.justify-items-end {
  justify-items: end;
}

.justify-items-center {
  justify-items: center;
}

.justify-items-stretch {
  justify-items: stretch;
}

.gap-0 {
  gap: 0;
}

.gap-0\.5 {
  gap: .125rem;
}

.gap-1 {
  gap: .25rem;
}

.gap-1\.5 {
  gap: .375rem;
}

.gap-10 {
  gap: 2.5rem;
}

.gap-11 {
  gap: 2.75rem;
}

.gap-12 {
  gap: 3rem;
}

.gap-14 {
  gap: 3.5rem;
}

.gap-16 {
  gap: 4rem;
}

.gap-2 {
  gap: .5rem;
}

.gap-2\.5 {
  gap: .625rem;
}

.gap-20 {
  gap: 5rem;
}

.gap-24 {
  gap: 6rem;
}

.gap-28 {
  gap: 7rem;
}

.gap-3 {
  gap: .75rem;
}

.gap-3\.5 {
  gap: .875rem;
}

.gap-32 {
  gap: 8rem;
}

.gap-36 {
  gap: 9rem;
}

.gap-4 {
  gap: 1rem;
}

.gap-40 {
  gap: 10rem;
}

.gap-44 {
  gap: 11rem;
}

.gap-48 {
  gap: 12rem;
}

.gap-5 {
  gap: 1.25rem;
}

.gap-52 {
  gap: 13rem;
}

.gap-56 {
  gap: 14rem;
}

.gap-6 {
  gap: 1.5rem;
}

.gap-60 {
  gap: 15rem;
}

.gap-64 {
  gap: 16rem;
}

.gap-7 {
  gap: 1.75rem;
}

.gap-72 {
  gap: 18rem;
}

.gap-8 {
  gap: 2rem;
}

.gap-80 {
  gap: 20rem;
}

.gap-9 {
  gap: 2.25rem;
}

.gap-96 {
  gap: 24rem;
}

.gap-px {
  gap: 1px;
}

.w-auto {
  width: auto;
}

.w-dvw {
  width: 100dvw;
}

.w-fit {
  width: fit-content;
}

.w-full {
  width: 100%;
}

.h-auto {
  height: auto;
}

.h-dvh {
  height: 100dvh;
}

.h-fit {
  height: fit-content;
}

.h-full {
  height: 100%;
}

.h-lvh {
  height: 100lvh;
}

.h-max {
  height: max-content;
}
</style>
</head>
    <body>

        <div class="main-windowp pixel deepFried"> 
                    <a href="home.html" style="min-width: 23px; max-height: 12px; background-color: transparent; position: absolute; top: 227px; right: 138px; border: 0px; font-size: 10px; text-align: center; cursor: pointer;">
     	&nbsp;
                    </a>
            <p id="countdown" style=" position: absolute; top: 10%; left: 40%; transform: translate(-50% -50%); color:white; font-size:64px; width:64px; height: 64px; text-align:center; background-color: black; background-blend-mode: difference; padding: 4px; mix-blend-mode: difference;">
                
                
            </p>
            
			<div class="container" style="align-items: center; justify-items: center; background-color: black; font-size: 10px;">
				
                <div id="instructions" style="display:flex; align-items: center; justify-items: center; flex-direction:column;">
                    
               
                    <img src="puzzle_label.png" style="margin-top: 4px;">

                    <button id="gameButton" class=" game-button pixel deepFried" >
                        Play
                    </button>
                    <p> Instructions: </p>
                    1. Try to memorize the images, you have 3 seconds for it!!<br><br>
                    2. Click on one block then click on another to swap places<br><br>
                    Future plans for this game:<br> * Add global highscore <br> *Add timeattack

	
            	 </div>
                <div id="highscore" style="display:flex; align-items:center; justify-content:center; flex-direction: column;">
                    <p style="font-size: 12px; margin: 0px; margin-top: 6px;">
                        Submit highscore
                        
                    </p>
                    
                    
                    <span>
                   
                    	<input id="inputName" type="text" maxlength="3" class="pixel deepFried" style="margin: 0px; outline: none; background-color:transparent; border:0px; color:white; text-align: start; width: 62px;  letter-spacing: 8px;" autocomplete="off">
                        <div style="display: flex; width:50px; flex-direction: row; gap: 4px; align-items:center; justify-content:center;">
                            <span style="height: 2px; width: 16px; background-color:white;"></span>
                            <span style="height: 2px; width: 16px; background-color:white;"></span>
                            <span style="height: 2px; width: 16px; background-color:white;"></span>
                        </div>
                    </span>
                    
                    <button id="submitHighscore" class="game-button pixel deepFried" style="margin-top: 8px;">
                        Submit
                    </button>
                    
                    <table id="highscoreTable" class="border: 0px; pixel deepFried" style="font-size: 8px; border-spacing: 3px;">
                        <th>PLAYER</th>
                        <th>TIME</th>
                        <th>SCORE</th>
                        <th>DATE</th>
                        
         
        
                    </table>
                  
                </div>
                
                <table id="puzzle">
                    <th>
                    	<tr>
                            <td id="1A" class="puzzle-block p1A"></td>
                            <td id="1B" class="puzzle-block p1B"></td>
                            <td id="1C" class="puzzle-block p1C"></td>
                            <td id="1D" class="puzzle-block p1D"></td>
                        </tr>
                    </th>
                    <th>
                    	<tr>
                            <td id="2A" class="puzzle-block p2A"></td>
                            <td id="2B" class="puzzle-block p2B"></td>
                            <td id="2C" class="puzzle-block p2C"></td>
                            <td id="2D" class="puzzle-block p2D"></td>
                        </tr>
                    </th>
                    <th>
                    	<tr>
                            <td id="3A" class="puzzle-block p3A"></td>
                            <td id="3B" class="puzzle-block p3B"></td>
                            <td id="3C" class="puzzle-block p3C"></td>
                            <td id="3D" class="puzzle-block p3D"></td>
                        </tr>
                        
                        <tr>
                            <td id="4A" class="puzzle-block p4A"></td>
                            <td id="4B" class="puzzle-block p4B"></td>
                            <td id="4C" class="puzzle-block p4C"></td>
                            <td id="4D" class="puzzle-block p4D"></td>
                        </tr>
                    </th>
                </table>
               
         
            </div>
        </div>
        <script type="text/tilescript"></script>
        <script type="text/tilescript">// object id
var puzzleContainer = document.getElementById("puzzle");
var instructions = document.getElementById("instructions");
var highscore = document.getElementById("highscore");

var highscoreBtn = document.getElementById("submitHighscore");
var lastUpdate = "2026-02-09";
// Highscore service
var playerId = null;
var moves = 0;
var initialTime = Date.now();
var playerName = "";
var gameId = 1;

function generateUUID() {
  return Date.now().toString() + "_webtileskuni_" + Math.random(2039).toString(); 
}


function formatDate(date) {
    date = new Date(date);
    var year = date.getFullYear();
	var hours = ('0' + date.getHours()).slice(-2);
  	var minutes = ('0' + date.getMinutes()).slice(-2);

    var month = date.getMonth();

    var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

    // 3. Manually pad the day
    var day = date.getDate();
    if (day < 10) {
        day = '0' + day;
    }
    
    var thing = "";
    if (day==3) thing = "rd";
    if (date==2) thing = "nd";
    if (date==1) thing = "st";
    
    if (date > 3) thing = "th";
    


    return months[month]  +" " + day+thing + " " + year;
}



function checkOrCreatePlayerId(){
    var id = window.localStorage.getItem("playerId");
    
    if (id)
        playerId = id;
    else {
        playerId = generateUUID();
    }
    
    window.localStorage.setItem("playerId", playerId);
    console.log("playing as " + playerId);
    
}

function clearPlayerData(){
    window.localStorage.removeItem("playerId");
}

checkOrCreatePlayerId();


function downloadHighscore(){
        
    console.log("downloading data from " + 'https://kunigames-api.vercel.app/api/getScoresByDate/'+lastUpdate+'/1');
    var xhr = new XMLHttpRequest();
	
    xhr.open('GET', 'https://kunigames-api.vercel.app/api/getScoresByDate/'+lastUpdate+'/1', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.setRequestHeader('X-API-Key', 'ilikeharajuku-core');

    xhr.onload = function () {


    if (xhr.status >= 200 && xhr.status < 300) {
        var scoreData = JSON.parse(xhr.responseText);
	
        for(var i = 0; i < scoreData.length; i++){
        var data = scoreData[i];
        console.log("adding row for:", data.name);
        addScoreRow(data.name, data.time, data.score, data.date);
        
            
            
    }

        
    } else {
    if (xhr.status == 404) 
        console.log ("scores not found");
    }
    };

    xhr.onerror = function () {
        console.error('Network request failed');
    };

    xhr.send();

}

function sendHighscore(){
    if (playerId == null) return;

    var elapsedTime = Date.now() - initialTime;
    var seconds = Math.floor(elapsedTime / 1000);
    var nameInput = document.getElementById("inputName");
    playerName = nameInput.value;
    console.log("pname: "  + nameInput)
    var score = calculateScore(seconds, moves);
    console.log("score: " + score);
    

    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'https://kunigames-api.vercel.app/api/submitScore', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.setRequestHeader('X-API-Key', 'ilikeharajuku-core');
    
    // Handle the response
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);

                // Do your stuff BEFORE calling callback
                console.log("is this running?");
                var nameInput = document.getElementById("inputName");
                nameInput.value = "";
                loadAndShowHighscore();

                // Then call callback with (error, data)
                callback(null, response);  // null = no error

            } else {
                callback(new Error('Request failed with status ' + xhr.status), null);
            }
        }
    };
    
    // Handle network errors
    xhr.onerror = function() {
        callback(new Error('Network error occurred'), null);
    };
    
    // Prepare the data
    var data = {
        name: playerName,
        gameId: gameId,
        time: seconds,
        score: score,
        playerId: playerId
    };
    
    // Send the request
    xhr.send(JSON.stringify(data));
    
  
    
    
    
}




// Puzzle game variables and init program

var gameStart = false;

var cursor = "";
var timeleft = 4;
var win = false;



var puzzleContainer = document.getElementById("puzzle");
puzzleContainer.style.display = "none";
var countdown = document.getElementById("countdown");
countdown.style.display = "none";

highscore.style.display = "none" ;

var gameButton = document.getElementById("gameButton");
gameButton.addEventListener("click", function (e) {
   startGame(); 
    initialTime = Date.now();
});



//Add click events
function addTilesEventListener (){
    var letters = ["A", "B", "C", "D"];
    for(i =1; i < 5; i++){
        for (j = 0; j <4; j++) {
            var obj = document.getElementById(i+letters[j]);
            obj.name = i+letters[j];
            obj.addEventListener("click", function (e) {
    			setOrChangePosition(e.target.id);
			});
        }
    }
}


function setOrChangePosition(pos) {
    if (timeleft <= 0 && !win){
        if (cursor == "") {
            cursor = pos;
            var obj = document.getElementById(pos);
            obj.className += " selected";
        }
        else {
            changePosition(cursor, pos);
            cursor = "";
        }
        
        checkWinCondition();
    }
    
    

}


//This change tiles positions
function changePosition(from, to) {
    var fromDOM = document.getElementById(from);
    var toDOM = document.getElementById(to);
    
    fromDOM.className = "puzzle-block p" + to;
    toDOM.className = "puzzle-block p" + from;
   
    fromDOM.id = to;
    toDOM.id = from;
    
}


//Mixup tiles
function initialRandomizer() {

    var tilesLength = 4*4;
    var letters = ["A", "B", "C", "D"];
    
    for(i =0; i < tilesLength; i++){
        var x1 = Math.floor(Math.random() * 4) + 1;
        var x2 = Math.floor(Math.random() * 4) + 1;
        
        changePosition(
            x1.toString() + letters[Math.floor(Math.random() * 4)], 		
            x2.toString() + letters[Math.floor(Math.random() * 4)]);
                                         
    }

}



// setTimeout(initialRandomizer, 3000);



function checkWinCondition (){
    var letters = ["A", "B", "C", "D"];
    for(i =1; i < 5; i++){
        for (j = 0; j <4; j++) {
            var obj = document.getElementById(i+letters[j]);
			if (obj.name != obj.id) return;
            
        }
    }
    var p = document.getElementById("countdown");
    p.style.display = "block";
    p.textContent  =" WIN!!";
	win = true;
    
    setTimeout(function () {
        loadAndShowHighscore();
        var p = document.getElementById("countdown");
        p.style.display = "none";
    }, 2000);

}

addTilesEventListener();



function loadAndShowHighscore() {
    puzzleContainer.style.display = "none";
    instructions.style.display = "none";
    highscore.style.display = "flex";
    
 	downloadHighscore();

    
}


function addScoreRow(name, time, score, date){

    var table = document.getElementById("highscoreTable");

    var tr = document.createElement("tr");

    var td1 = document.createElement("td");
    td1.textContent = name;

    var td2 = document.createElement("td");
    td2.textContent = time;

    var td3 = document.createElement("td");
    td3.textContent = score;

    var td4 = document.createElement("td");
    td4.textContent = formatDate(date);

    tr.appendChild(td1);
    tr.appendChild(td2);
    tr.appendChild(td3);
    tr.appendChild(td4);

    table.appendChild(tr);


}

function calculateScore(timeInSeconds, moves) {
    var baseScore = 500;

    baseScore -= timeInSeconds;

    baseScore -= (moves * 2) / 2;
    if (moves <= 10) {
        baseScore += 50;
    }

    // Ensure score doesn't go negative
    return Math.max(0, baseScore);
}


highscoreBtn.addEventListener("click", function (){
    sendHighscore();
});

function startGame() {

	puzzleContainer.style.display = "block";
    

    instructions.style.display = "none";
    
  
  
    
    var downloadTimer = setInterval(function(){
    var p = document.getElementById("countdown");
    p.style.display = "block";
    if(timeleft <= 0){
        clearInterval(downloadTimer);
        initialRandomizer();
        p.style.display = "none";
    }
    var remaining= 4 - timeleft;
    
    p.textContent  = remaining;
    
    timeleft -= 1;
}, 1000);
}



</script>
    </body>
</html>