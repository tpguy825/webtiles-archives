<!DOCTYPE html>
<html lang="en">
<head>
<style>#shop-tile {
  color: #01579b;
  box-sizing: border-box;
  user-select: none;
  background-color: #e1f5fe;
  border: 4px solid #0a737a;
  width: 250px;
  height: 250px;
  font-family: MS PGothic, Saitamaar, sans-serif;
  position: relative;
  overflow: hidden;
}

#header-box {
  background: #fff;
  border: 2px solid #38b9c2;
  align-items: center;
  height: 90px;
  margin: 5px;
  padding: 5px;
  display: flex;
  position: relative;
}

#miku-img {
  width: 90px;
  height: 90px;
  image-rendering: pixelated;
  cursor: pointer;
}

#dialogue-box {
  flex: 1;
  padding-left: 8px;
  padding-right: 5px;
  font-size: .9em;
  line-height: 1.2;
}

.site-link {
  color: #38b9c2;
  border-bottom: 1px dotted #38b9c2;
  font-size: 10px;
  text-decoration: none;
  position: absolute;
  bottom: 2px;
  right: 4px;
}

.site-link:hover {
  color: #0a737a;
  border-bottom: 1px solid #0a737a;
}

#stats-bar {
  color: #fff;
  background: #6ad4c2;
  justify-content: space-between;
  padding: 2px 8px;
  font-size: 12px;
  font-weight: bold;
  display: flex;
}

#item-list {
  background: #ffffff80;
  height: 110px;
  padding: 5px;
  overflow-y: scroll;
}

.item-row {
  cursor: pointer;
  color: #288994;
  border-bottom: 1px solid #b3e5fc;
  justify-content: space-between;
  padding: 4px;
  font-size: 12px;
  display: flex;
}

.item-row:hover {
  color: #fff;
  background: #097f87;
}

.price {
  font-weight: bold;
}

#item-list::-webkit-scrollbar {
  width: 4px;
}

#item-list::-webkit-scrollbar-thumb {
  background: #0288d1;
}
</style>
</head>
<body>
<div id="shop-tile">
  <audio id="miku-audio" src="popipo.mp3" preload="metadata"></audio>
  <audio id="famima-audio" src="familymart.mp3" preload="metadata"></audio>
  <audio id="kaching-audio" src="kaching.mp3" preload="metadata"></audio>

  <div id="stats-bar">
    <span>FamilyMart x Miku</span>
    <span>¥ <span id="money-display">100</span></span>
  </div>

  <div id="header-box">
    <img id="miku-img" src="mikustand.png" alt="Miku">
    <div id="dialogue-box">Welcome! What would you like to buy?</div>
    <a href="https://electric-tenshi.nekoweb.org/" class="site-link" target="_blank">electric-tenshi</a>
  </div>

  <div id="item-list">
    <div class="item-row" id="item-0"><span>Famichiki</span><span class="price">¥180</span></div>
    <div class="item-row" id="item-1"><span>Negi (Leek)</span><span class="price">¥50</span></div>
    <div class="item-row" id="item-2"><span>Vegetable juice</span><span class="price">¥200</span></div>
    <div class="item-row" id="item-3"><span>Mysterious ticket...?</span><span class="price">¥500</span></div>
    <div class="item-row" id="item-4"><span>Melon bread</span><span class="price">¥150</span></div>
    <div class="item-row" id="item-5"><span>Beef-flavored cup noodle</span><span class="price">¥20</span></div>
    <div class="item-row" id="item-6"><span>Taiyaki ice-cream</span><span class="price">¥30</span></div>
  </div>
</div>

<script type="text/tilescript">
  // im going insane
  var money = 100;
  var items = [
    { name: "Famichiki", price: 180, msg: "The best snack!" },
    { name: "Negi (Leek)", price: 50, msg: "Thank you! I love these!" },
    { name: "Vegetable juice", price: 200, msg: "PO-PI-PO-PI-PO-PO-PI-PO!!" },
    { name: "Mysterious ticket...?", price: 500, msg: "Huh? Where am I this time?" },
    { name: "Melon bread", price: 150, msg: "Perfect in this cold weather!" },
    { name: "Beef-flavored cup noodle", price: 20, msg: "Noodles! Just what I need while cramming homework!"},
    { name: "Taiyaki ice cream", price: 30, msg: "A sweet treat! I hope Luka-chan doesn't see me eating this..."}
  ];

  var moneyEl = document.getElementById("money-display");
  var dialogueEl = document.getElementById("dialogue-box");
  var mikuEl = document.getElementById("miku-img");
  var shopTile = document.getElementById("shop-tile");
  var popipoAudio = document.getElementById("miku-audio");
  var famimaAudio = document.getElementById("famima-audio");
  var kachingAudio = document.getElementById("kaching-audio");

  // Money replenishment
  setInterval(function() {
    money = money + 10;
    moneyEl.textContent = money;
  }, 10000);

  // State reset logic
  function setDialogue(text, isHappy) {
    dialogueEl.textContent = text;
    
    if (isHappy) {
      mikuEl.src = "mikustand2.png";
    } else {
      mikuEl.src = "mikustand.png";
    }

    // After 3 seconds, Miku goes back to idle and original greeting
    setTimeout(function() {
      mikuEl.src = "mikustand.png";
      dialogueEl.textContent = "Welcome! What would you like to buy?";
    }, 3000);
  }

  // Jingle effect
  mikuEl.addEventListener("click", function() {
    if (famimaAudio) {
      famimaAudio.currentTime = 0;
      famimaAudio.play();
    }
    setDialogue("Welcome to FamilyMart!", true);
  });

  // Secret effects
  function triggerSecret(itemName) {
    if (itemName === "Mysterious ticket...?") {
      shopTile.style.backgroundColor = "#e1bee7"; 
      shopTile.style.borderColor = "#9c27b0";
    }
    
    if (itemName === "Vegetable juice") {
      if (popipoAudio) {
        popipoAudio.currentTime = 0;
        popipoAudio.play();
      }
    }
  }

  // Bind clicks to items
  for (var i = 0; i < items.length; i++) {
    (function(index) {
      var item = items[index];
      var itemElement = document.getElementById("item-" + index);
      
      if (itemElement) {
        itemElement.addEventListener("click", function() {
          if (money >= item.price) {
            money = money - item.price;
            moneyEl.textContent = money;
          if (kachingAudio) {
              kachingAudio.currentTime = 0;
              kachingAudio.play();
            } 
            setDialogue(item.msg, true);
            triggerSecret(item.name);
          } else {
            setDialogue("You don't have enough money...", false);
          }
        });
      }
    })(i);
  }
</script>
</body>
</html>