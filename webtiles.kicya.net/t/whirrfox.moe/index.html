<!DOCTYPE html>
<html lang="en">
<head>
    <style>.tile-body {
  background-color: #fffdf2;
  background-image: url("background-animation.webp");
  background-repeat: repeat;
  background-size: 50%;
  margin: 0;
  font-family: Playpen, sans-serif;
  font-weight: 500;
}

a {
  color: #000;
  text-decoration-style: dotted;
}

.cutebox {
  text-align: justify;
  border-image-source: url("cutebox-4.png");
  border-image-slice: 46 fill;
  border-image-width: 20px;
  border-image-repeat: round;
  margin: 8px;
  padding: 20px;
}

p:first-child {
  margin-top: 0;
}

p:has(img) {
  align-items: center;
  gap: 8px;
  display: flex;
}

p img {
  width: 75px;
}

.back-button {
  text-align: center;
  display: block;
}

@font-face {
  font-family: Playpen;
  src: url("PlaypenSans.ttf");
}
</style>
    <style>.col {
  flex-direction: column;
  justify-content: end;
  align-items: center;
  gap: 4px;
  height: 100%;
  display: flex;
}

.col a {
  text-align: center;
}

.row {
  flex-direction: row;
  justify-content: space-between;
  display: flex;
}

.row ul {
  text-align: center;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 12px;
  padding: 8px;
  font-size: 1.1rem;
  line-height: 1;
  list-style: none;
  display: flex;
}

li a {
  background-color: #fdecfd;
  border: 1px solid #e6a3f7;
  border-radius: 12px;
  padding: 8px;
  transition: transform .3s ease-in-out;
  display: block;
  transform: rotate(-3deg)translateY(-14px);
}

li a:hover {
  transform: translateY(-14px);
}

.logo {
  width: 85%;
}

.sophia {
  flex-direction: column;
  justify-content: end;
  transition: transform .2s cubic-bezier(0, 0, .75, 10);
  display: flex;
  position: relative;
}

.sophiaImg {
  width: 100%;
}

.sophia-happy {
  width: 80px;
  position: absolute;
  top: 63px;
  left: 24px;
}

.note {
  font-size: 9px;
  position: fixed;
  bottom: 4px;
  left: 24px;
  transform: rotate(-2deg);
}
</style>
</head>
<body>
    <div class="col">
        <a href="https://whirrfox.moe/" target="_blank">
        	<img class="logo" src="whirrfox.webp">
        </a>
        <div class="row">
            <ul>
                <li><a href="about-me.html">about me</a></li>
                <li><a href="sophia.html">Sophia</a></li>
            </ul>
        <div id="sophiaContainer" class="sophia" style="transform: translateY(1px)">
        	<img id="sophia" class="sophiaImg" src="sophia-tail.webp">      
            <img class="sophia-happy" src="sophia-w.png" style="display: none;">
        </div>
        </div>
    </div>
    <div class="note">
        (You can pat<br>her head :3)
    </div>
    <script type="text/tilescript">// Only executes while your tile is active
// Only ES5 is supported, limited subset of APIs - DOM, localStorage, XMLHttpRequest, Canvas.
console.log("Hello world!");</script>
    <script type="text/tilescript">var prevScreenX = 0;
var movement = 0;
var patCounted = false;
var pats = 0;
var patTime = -1;
var patTimer = null;
var isHovering = false;
var inHeadpadArea = false;
var isMobile = false;
var sophia = document.getElementById("sophia");
var sophiaContainer = document.getElementById("sophiaContainer");
var sophiaHappy = document.querySelector(".sophia-happy")
function removeAnimations() {
  
}

console.log(sophia)
console.log(sophiaContainer)

function isHeadpatArea(x, y) {
  return x > 20 && x < 120 && y > 0 && y < 90;
}

sophia.addEventListener("pointerenter", function () {
  isHovering = true;
  if (patTime < 0) {
    // sophia.classList.add("animate-jump");
    // sophia.src = "/assets/images/ghost-sophia2.webp";
  }
});
sophia.addEventListener("pointerleave", function () {
  isHovering = false;
  if (patTime < 0) {
    // sophia.classList.add("animate-smol-jump");
    // sophia.src = "/assets/images/ghost-sophia.webp";
  }
});

sophia.addEventListener("mousemove", function (e) {
  showParticles(e.offsetX, e.offsetY);
  headpats(e.offsetX, e.offsetY);
});

/* sophia.addEventListener("touchmove", function (e) {
  isMobile = true;
  var client = e.touches[0];
  showParticles(client.clientX, client.clientY);
  headpats(client.clientX, client.clientY);
});*/

function sign(num) {
    if (num >= 0) {
        return "+"
    }
    return "-"
}

function headpats(x, y) {
  inHeadpadArea = isHeadpatArea(x, y);
  if (!inHeadpadArea) {
    // sophiaContainer.classList.remove("cute-hand");
    return;
  }
  // if (!sophiaContainer.classList.contains("cute-hand"))
  //  sophiaContainer.classList.add("cute-hand");

  var movementX = x - prevScreenX;
  prevScreenX = x;
	console.log(Math)
  // check patting direction
  if (sign(movementX) !== sign(movement)) {
    movement = movementX;
    patCounted = false;
  } else {
    movement += movementX;
  }

  // check if it was a pat
    console.log("pat?")
  if (!patCounted && Math.abs(movementX) > 5) {
    patCounted = true;
    pats++;
    if (pats <= 4) {
      return;
    }
    patTime = 2;
      console.log(patTimer)
    if (!patTimer) {
      //sophia.classList.add("animate-smol-jump");
      sophiaContainer.style.transform = "translateY(0px)";
      sophiaHappy.style.display = "";
      patTimer = setInterval(headpatInterval, 1000);
    }
  }
}

function headpatInterval() {
    console.log("patTime", patTime)
    patTime--;
        if (patTime < 0) {
          clearInterval(patTimer);
          patTimer = null;
          pats = 0;
          sophiaHappy.style.display = "none";
          sophiaContainer.style.transform = "translateY(1px)"
        }
}

var canShowParticle = true;
function showParticles(x, y) {
  if (canShowParticle && patTime > 0 && isHeadpatArea(x, y)) {
    createParticle(x, y);
    canShowParticle = false;
    setTimeout(function() {canShowParticle = true}, 600);
  }
}

function createParticle(x, y) {
  var img = document.createElement("img");
  img.src = "/heart.webp";
  img.style.position = "absolute";
  img.style.left = x + "px";
  img.style.top = y + "px";
  img.style.width = "20px";
  img.style.height = "20px";
  img.style.rotate = Math.random() * 40 - 20 + "deg";
  sophiaContainer.appendChild(img);

  var opacity = 140;
  var dx = Math.random() >= 0.5 ? 0.25 : -0.25;
  var p = setInterval(function () {
    x += dx;
    y -= 0.75;
    opacity -= 0.75;
    img.style.top = y + "px";
    img.style.left = Math.floor(x) + "px";
    img.style.opacity = opacity + "%";
    if (opacity <= 0) {
      img.remove();
      img = null;
      clearInterval(p);
    }
  }, 10);
}</script>
</body>
</html>